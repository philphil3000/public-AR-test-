<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>AR.js Static Model</title>

    <!-- A-Frame and AR.js -->
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.min.js"></script>

    <!-- Auto-center and auto-resize helpers -->
    <script>
      // Automatically resize model to fit target size
      AFRAME.registerComponent('auto-resize', {
        schema: { targetSize: { type: 'number', default: 1 } },
        init: function () {
          this.el.addEventListener('model-loaded', () => {
            const mesh = this.el.getObject3D('mesh');
            if (!mesh) return;

            const box = new THREE.Box3().setFromObject(mesh);
            const size = new THREE.Vector3();
            box.getSize(size);
            const maxDim = Math.max(size.x, size.y, size.z);
            const scaleFactor = this.data.targetSize / maxDim;

            this.el.object3D.scale.set(scaleFactor, scaleFactor, scaleFactor);
            console.log(`✅ Auto-scaled model by factor: ${scaleFactor.toFixed(3)}`);
          });
        }
      });

      // Automatically center model (align base of model to marker)
      AFRAME.registerComponent('auto-center', {
        init: function () {
          this.el.addEventListener('model-loaded', () => {
            const mesh = this.el.getObject3D('mesh');
            if (!mesh) return;

            const box = new THREE.Box3().setFromObject(mesh);
            const center = new THREE.Vector3();
            box.getCenter(center);

            // Move so base rests on marker
            mesh.position.sub(center);
            mesh.position.y -= box.min.y;

            console.log('✅ Model centered and grounded on marker');
          });
        }
      });
    </script>
  </head>

  <body style="margin: 0; overflow: hidden;">
    <a-scene
      embedded
      vr-mode-ui="enabled: false"
      renderer="logarithmicDepthBuffer: true;"
      arjs="sourceType: webcam; debugUIEnabled: false;"
    >
      <!-- Lighting -->
      <a-entity light="type: ambient; intensity: 1"></a-entity>
      <a-entity light="type: directional; intensity: 0.8" position="1 1 0"></a-entity>

      <!-- Marker with smoothing for stable tracking -->
      <a-marker preset="hiro"
                smooth="true"
                smoothCount="10"
                smoothTolerance="0.01"
                smoothThreshold="5">

        <!-- Static model -->
        <a-entity
          gltf-model="./SXT1v2.glb"
          auto-center
          auto-resize="targetSize: 1"
          position="0 0 0"
          rotation="0 0 0">
        </a-entity>

      </a-marker>

      <!-- Camera -->
      <a-entity camera="near: 0.01; far: 1000;"></a-entity>
    </a-scene>
  </body>
</html>
